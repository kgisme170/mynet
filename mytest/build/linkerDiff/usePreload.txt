gcc -o libd2.so d2.c -fPIC --shared
gcc -o libd1.so d1.c -fPIC --shared
gcc m.c -L. -ld1 -o md1
gcc m.c -L. -ld2 -o md2
./md1
./md2
ldd md1
ldd md2
export LD_PRELOAD="./libd2.so"
./md1

cp d1.c d1.cpp
cp d2.c d2.cpp
cp m.c m.cpp
g++ -o libd1++.so d1.cpp -fPIC --shared
g++ -o libd2++.so d2.cpp -fPIC --shared
g++ m.cpp -L. -ld1++ -o md1++
g++ m.cpp -L. -ld2++ -o md2++
export LD_PRELOAD="./libd2++.so"
./md1++
./md2++
export LD_PRELOAD=
./md1++

cat d1.cpp
#include<stdio.h>
void f(){
    puts("l1\n");
}
cat d2.cpp
#include<stdio.h>
void f(){
    puts("l2\n");
}
cat m.cpp
int main(){
    void f();
    f();
    return 0;
}