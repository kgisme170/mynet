import os,sys,subprocess
def runCmd(cmd) :
    res = subprocess.Popen(cmd, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    sout ,serr = res.communicate()
    return res.returncode
env = Environment(ENV = {'PATH' : os.environ['PATH']})
env.Append(CXXFLAGS="-Wall")
env.Append(CXXFLAGS="-Werror")
if runCmd("testcpp.sh 11") == 0:
    env.SConscript(dirs=['cpp11'])
if runCmd("testcpp.sh 14") == 0:
    env.SConscript(dirs=['cpp14'])
if runCmd("testcpp.sh 17") == 0:
    env.SConscript(dirs=['cpp17'])
env.SConscript(dirs=['cpp98'])
env.SConscript(dirs=['datastructure'])
env.SConscript(dirs=['grpc'])
env.SConscript(dirs=['linkerDiff'])
env.SConscript(dirs=['linkerDynamic'])
env.SConscript(dirs=['multiplex/posix'])
env.SConscript(dirs=['multiplex/pthread'])
env.SConscript(dirs=['os'])
env.SConscript(dirs=['protobuf'])
env.SConscript(dirs=['usethrift'])

if sys.platform.find('linux')==0:
    env.SConscript(dirs=['jni'])
    env.SConscript(dirs=['multiplex/linux'])
else:
    env.SConscript(dirs=['3p'])
